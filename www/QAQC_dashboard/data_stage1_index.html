<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">

  <title>Data, Stage 1</title>

  <!-- Bootstrap core CSS -->
  <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

  <!-- Custom styles for this template -->
  <link href="css/simple-sidebar.css" rel="stylesheet">

</head>

<body>

  <div class="d-flex" id="wrapper">

    <!-- Sidebar -->
    <div class="bg-light border-right" id="sidebar-wrapper">
      <div class="sidebar-heading"><a href="index.html">Data QA/QC Home</a></div>
      <div class="list-group list-group-flush">
        <a href="#" onclick="loadTables('HITL_Stage1')" class="list-group-item list-group-item-action bg-light">HITL Status</a>
        <a href="#" onclick="loadPlots('ADCP')" class="list-group-item list-group-item-action bg-light">ADCP</a>
        <a href="#" onclick="loadPlots('BOTPT')" class="list-group-item list-group-item-action bg-light">BOTPT</a>
        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                CTD
              </a>
              <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown">
                <a class="dropdown-item" href="#" onclick="loadPlots('temperature')">Temperature</a>
                <a class="dropdown-item" href="#" onclick="loadPlots('salinity')">Salinity</a>
                <a class="dropdown-item" href="#" onclick="loadPlots('density')">Density</a>
                <a class="dropdown-item" href="#" onclick="loadPlots('oxygen')">Oxygen</a>
              </div>
        <a href="#" onclick="loadPlots('DO2')" class="list-group-item list-group-item-action bg-light">OXYGEN</a>
        <a href="#" onclick="loadPlots('FL')" class="list-group-item list-group-item-action bg-light">FLUOROMETER</a>
        <a href="#" onclick="loadPlots('NUTNR')" class="list-group-item list-group-item-action bg-light">NUTNR</a>
        <a href="#" onclick="loadPlots('PARAD')" class="list-group-item list-group-item-action bg-light">PARAD</a>
        <a href="#" onclick="loadPlots('PHSEN')" class="list-group-item list-group-item-action bg-light">PHSEN</a>
        <a href="#" onclick="loadPlots('PCO2W')" class="list-group-item list-group-item-action bg-light">PCO2W</a>
        <a href="#" onclick="loadPlots('SPKIR')" class="list-group-item list-group-item-action bg-light">SPKIR</a>
        <a href="#" onclick="loadPlots('VELPT')" class="list-group-item list-group-item-action bg-light">VELPT</a>
      </div>
    </div>
    <!-- /#sidebar-wrapper -->

    <!-- Page Content -->
    <div id="page-content-wrapper">

      <nav class="navbar navbar-expand-lg navbar-light bg-light border-bottom">
      
      <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav ml-auto mt-2 mt-lg-0">
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Data Range
              </a>
              <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown">
                <a class="dropdown-item" href="#" onclick="togglePlots('full');">full range</a>
                <a class="dropdown-item" href="#" onclick="togglePlots('local');">local range</a>
              </div>
            </li>
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Time Spans
              </a>
              <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown">
                <a class="dropdown-item" href="#" onclick="togglePlots('day');">1 day</a>
                <a class="dropdown-item" href="#" onclick="togglePlots('week');">1 week</a>
                <a class="dropdown-item" href="#" onclick="togglePlots('month');">1 month</a>
                <a class="dropdown-item" href="#" onclick="togglePlots('year');">1 year</a>
              </div>
            </li>
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Overlays
              </a>
              <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown">
                <a class="dropdown-item" href="#" onclick="togglePlots('clim');">Climatology</a>
                <a class="dropdown-item" href="#" onclick="togglePlots('near');">Nearest Neighbor</a>
                <a class="dropdown-item" href="#" onclick="togglePlots('time');">Time Machine</a>
                <a class="dropdown-item" href="#" onclick="togglePlots('none');">None</a>
              </div>
            </li>
            
          </ul>
        </div>
    

        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav ml-auto mt-2 mt-lg-0">
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Site Navigation
              </a>
              <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown">
                <a class="dropdown-item" href="site_index.html">Data: by Site</a>
                <a class="dropdown-item" href="platform_index.html">Data: by Platform Type</a>
                <a class="dropdown-item" href="data_stage1_index.html">Data: Stage 1</a>
                <a class="dropdown-item" href="data_stage2_index.html">Data: Stage 2</a>
                <a class="dropdown-item" href="data_stage3_index.html">Data: Stage 3</a>
                <a class="dropdown-item" href="data_stage4_index.html">Data: Stage 4</a>
                <a class="dropdown-item" href="http://status.ooirsn.uw.edu:8000/alarms" target="_blank">Alerts and Issues</a>
              </div>
            </li>
          </ul>
        </div>
      </nav>

      <div class="dataDiv">
        <div id="HITLstatus"><img alt="" src="HITL_plot1.png" /></div>
        <div id="plots"></div> 
      </div>
    </div>
    <!-- /#page-content-wrapper -->

  </div>
  <!-- /#wrapper -->

  <!-- Bootstrap core JavaScript -->
  <script src="vendor/jquery/jquery.min.js"></script>
  <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  
  <!-- Menu Toggle Script -->
  
  <script type="text/javascript">
  <!--
  var siteImages = {}
  var imagePosition = {}

	function syncCallAjax(keyWord){
 	  
 		var remote = '__Unset__';
 		var request = new XMLHttpRequest();
 		var remote_url;
 
    if (keyWord.includes('HITL')){
         remote_url = '/cgi-bin/csvList.py?keyWord=' + encodeURIComponent(keyWord);
    } else {
 		     remote_url = '/cgi-bin/plotList.py?keyWord=' + encodeURIComponent(keyWord);
    }
 		request.open('GET', remote_url, false);  // false makes the request synchronous
 		request.send(null);
 
 		if (request.status === 200)
 		{
 			remote = request.responseText;
 		}
 		return(remote);
 	}

function slide(siteID){
    console.log(siteID)
    var imageList = siteImages[siteID]
    var image_current = imagePosition[siteID]
    var image_length = imageList.length;

    if (image_current == image_length){
     image_current = 0;
    }
     var slideshowImage = document.getElementById(siteID + '-slideshow')
     slideshowImage.src = imageList[image_current];
     image_current++;
     imagePosition[siteID] = image_current;
   }

    function loadTables(stream) {
      document.getElementById('HITLstatus').innerHTML = "";
      document.getElementById('HITLstatus').style.display = 'block';
      document.getElementById('plots').innerHTML = "";
      console.log(stream)
      var csv_files = JSON.parse(syncCallAjax(stream));
      console.log(csv_files);
      csv_files.sort()
        $(document).ready(function(){
            //$('#btn_load').click(function(){
                for(var i=0; i<csv_files.length; i++)
                    $.ajax({
                        url: csv_files[i],
                        dataType:'text',
                        success:function(data){
                            var rows = data.split(/\r?\n|\r/);
                            var table = '<table border=5px outset grey; padding: 10px; width="90%"><col style="width:25%"><col style="width:75%">';
                            //row - iteration

                            //print table header
                            var re = new RegExp (/HITL_notes\/HITL_\S*_(\S*)\.csv/gm);
                            var header = re.exec(this.url)[1];
                            var headings = rows[0].split(",");
                            table += '<thead><tr>';
                            table += '<th>' + header + '</th>';
                            table += '</tr></thead>';

                            //print table body
                            table += '<tbody>';
                            for(var j=0; j<rows.length; j++){
                                var data_cell = rows[j].split(",");
                                table += '<tr>';
                                for(var k=0; k<headings.length; k++)
                                  if (data_cell[k] != null){
                                    table += '<td>' + data_cell[k] + '</td>';
                                  }
                                table += '</tr>';
                            }
                            table += '</tbody>';

                            //closing table, add line break, appending result to div
                            table += '</table><br>';
                            $('#HITLstatus').append(table);
                        }
                    });   
           // }); 
        });
      }






    function loadPlots(stream) {
       document.getElementById('plots').innerHTML = "";
       if (stream.includes('default')){
         document.getElementById('HITLstatus').style.display = 'block';
       } else {
         document.getElementById('HITLstatus').style.display = 'none';
         console.log(stream)
         var fileList = JSON.parse(syncCallAjax(stream));
         console.log(fileList);
         var sliderPlots = [];
		for (let i = 0; i < fileList.length; i++) {
  		  if (fileList[i].includes('meters_')) {
    		sliderPlots.push(fileList[i]);
    		var site = fileList[i].substring(11, 19);
    		fileList[i] = site
  		  }
		}
		
		fileList = [...new Set(fileList)];
         var arrayLength = fileList.length;
         for(var i=1; i<=arrayLength; i++) {
           var imageFile = fileList[i-1];
           if (imageFile.length == 8) {
             var subPlots = sliderPlots.filter(function(str) { return str.includes(imageFile); } );   
			
             var subSubPlots = [];
             for(var k=1; k<=subPlots.length; k++){
               var plotString = subPlots[k-1]
               subSubPlots.push(plotString);
             }   
             siteImages[imageFile] = subSubPlots;
             imagePosition[imageFile] = 0;
             var sliderDiv = document.createElement("div");
             sliderDiv.setAttribute("id",imageFile)
             var innerHTMLstr = '<img id="' + imageFile + '-slideshow" /><button onclick="slide(this.parentNode.id)">Click me</button>';
             sliderDiv.innerHTML = innerHTMLstr;
             var src = document.getElementById('plots');
             src.appendChild(sliderDiv);
             slide(imageFile)

 
           }else{
             var img = document.createElement("img");
             img.src = imageFile
             //img.style.width = "1300px";
			 //img.style.height = "500px";
             var src = document.getElementById('plots');
             src.appendChild(img);
           }
         }
         
       }

    }

    function togglePlots(toggle) {
      var timespans = ['day','week','month','year'];
      var overlays = ['none','clim','near','time'];
      var ranges = ['full','local'];
      var imgStr = document.getElementById('plots').innerHTML;
      var m = imgStr.includes("HITL");
      if(m == false){
        if (timespans.includes(toggle)){
          for (var i=0; i<=timespans.length; i++) {
            if (imgStr.includes(timespans[i])) {
              var imgStrReplace = imgStr.replace(new RegExp(timespans[i],"g"), toggle);
              for (let key in siteImages){
                var toggleArray = []
                for (index = 0; index < siteImages[key].length; index++ ){
                var plotString = siteImages[key][index]
                  toggleArray.push(plotString.replace(new RegExp(timespans[i],"g"), toggle));
                }
            	siteImages[key]=toggleArray;
              }
              break;
            }
          }
        }else if (overlays.includes(toggle)){
          for (var j=0; j<=overlays.length; j++) {
            if (imgStr.includes(overlays[j])) {
              var imgStrReplace = imgStr.replace(new RegExp(overlays[j],"g"), toggle);
              for (let key in siteImages){
                var toggleArray = []
                for (index = 0; index < siteImages[key].length; index++ ){
                var plotString = siteImages[key][index]
                  toggleArray.push(plotString.replace(new RegExp(overlays[j],"g"), toggle));
                }
            	siteImages[key]=toggleArray;
              }
              break;
            }
          }
        }else if (ranges.includes(toggle)){
          for (var k=0; k<=ranges.length; k++) {
            if (imgStr.includes(ranges[k])) {
              var imgStrReplace = imgStr.replace(new RegExp(ranges[k],"g"), toggle);
              for (let key in siteImages){
                var toggleArray = []
                for (index = 0; index < siteImages[key].length; index++ ){
                var plotString = siteImages[key][index]
                  toggleArray.push(plotString.replace(new RegExp(ranges[k],"g"), toggle));
                }
            	siteImages[key]=toggleArray;
              }
              break;
            }
          }
        }
        document.getElementById('plots').innerHTML = imgStrReplace;
      }
    }
//-->
</script>


</body>

</html>
